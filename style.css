:root {
    --bg-color: #050505;
    --ui-bg: rgba(10, 10, 10, 0.95);
    --font: 'Courier New', monospace;
}
body { margin: 0; overflow: hidden; background: var(--bg-color); font-family: var(--font); color: white; user-select: none; }
canvas { display: block; width: 100%; height: 100%; }

/* UI OVERLAY */
#ui-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; display: flex; flex-direction: column; justify-content: space-between; }

/* HUD TOP */
.hud-top { display: flex; justify-content: space-between; padding: 25px; width: 90%; margin: 0 auto; }
.fighter-hud { width: 420px; background: var(--ui-bg); padding: 15px; border: 2px solid #333; border-radius: 6px; box-shadow: 0 0 20px rgba(0,0,0,0.5); transition: border-color 0.3s; }

.name-tag { font-size: 1.5rem; font-weight: 900; margin-bottom: 5px; letter-spacing: 2px; text-shadow: 0 0 10px currentColor; }
.bar-wrap { height: 16px; background: #222; margin-bottom: 8px; border: 1px solid #444; position: relative; }
.bar-fill { height: 100%; transition: width 0.1s linear; position: relative; z-index: 2; }
.bar-txt { position: absolute; top: 0; left: 5px; font-size: 11px; z-index: 3; line-height: 16px; font-weight: bold; }

.hp { background: linear-gradient(90deg, #15803d, #22c55e); }
.ce { background: linear-gradient(90deg, #4338ca, #6366f1); }
.domain-gauge { background: linear-gradient(90deg, #000, #a855f7); box-shadow: 0 0 10px #a855f7; }
.fatigue { background: #fff; opacity: 0.8; transition: width 0.1s; } 

/* HUD BOTTOM */
.hud-bottom { display: flex; flex-direction: column; align-items: center; padding-bottom: 30px; gap: 15px; }

.controls-row { display: flex; gap: 15px; background: rgba(0,0,0,0.6); padding: 8px 20px; border-radius: 30px; border: 1px solid #444; }
.ctrl-key { background: #fff; color: #000; padding: 2px 6px; border-radius: 4px; font-weight: bold; font-size: 0.8rem; margin-right: 5px; }

.skills-row { display: flex; gap: 20px; }
.skill-box {
    width: 90px; height: 90px; background: #1a1a1a; border: 2px solid #555; position: relative;
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    border-radius: 8px; overflow: hidden; box-shadow: 0 5px 15px rgba(0,0,0,0.5);
}
.skill-key { position: absolute; top: 4px; left: 4px; font-size: 0.7rem; color: #aaa; }
.skill-icon { font-size: 2.5rem; }
.skill-name { position: absolute; bottom: 0; width: 100%; text-align: center; font-size: 0.6rem; background: rgba(0,0,0,0.8); padding: 3px 0; color: #bbb; }
.cd-overlay { position: absolute; bottom: 0; left: 0; width: 100%; height: 0%; background: rgba(200, 50, 50, 0.7); transition: height 0.1s linear; }

/* ALERTS */
#alert-banner {
    position: absolute; top: 30%; width: 100%; text-align: center;
    font-size: 5rem; font-weight: 900; color: #fff; display: none;
    text-shadow: 0 0 30px currentColor; z-index: 10;
    animation: pulse 0.1s infinite;
}
#bf-counter {
    position: absolute; top: 45%; width: 100%; text-align: center;
    font-size: 3rem; font-weight: 900; color: #b91c1c; display: none;
    text-shadow: 0 0 20px #000; z-index: 10;
}
@keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.02); } 100% { transform: scale(1); } }

/* MENUS */
.menu-screen {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(5,5,5,0.98); z-index: 20;
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    pointer-events: all;
}
.btn-start {
    background: transparent; border: 2px solid white; color: white;
    padding: 15px 50px; font-size: 1.5rem; cursor: pointer; margin-top: 30px;
    font-family: var(--font); transition: 0.3s;
}
.btn-start:hover { background: white; color: black; box-shadow: 0 0 20px white; }

.roster { display: grid; grid-template-columns: 1fr 1fr; gap: 60px; margin-top: 30px; }
.roster-col { display: flex; flex-direction: column; gap: 10px; }
.roster-header { text-align: center; border-bottom: 2px solid; padding-bottom: 5px; margin-bottom: 10px; font-size: 1.2rem; }
.char-btn {
    padding: 12px 20px; background: #222; border: 1px solid #444; color: #ddd; cursor: pointer;
    text-align: left; transition: 0.2s; position: relative;
}
.char-btn:hover { background: #333; color: #fff; border-color: #fff; transform: translateX(10px); }

/* CINEMATIC INTRO */
#intro-layer {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    background: #000; z-index: 100; display: none;
    align-items: center; justify-content: center;
    flex-direction: column;
}
.cut-in-face {
    width: 300px; height: 120px; /* Focused on eyes */
    background: #ffe0bd;
    border-top: 4px solid #000; border-bottom: 4px solid #000;
    position: relative; overflow: hidden;
    display: flex; justify-content: center; align-items: center;
    box-shadow: 0 0 50px currentColor;
}
/* Specific Gojo Intro Mods */
.gojo-blindfold {
    width: 100%; height: 60px; background: #111;
    position: absolute; top: 30px; left: 0;
    box-shadow: 0 5px 10px rgba(0,0,0,0.5);
}

.cut-in-eyes {
    width: 100%; height: 40px; background: #000; 
    position: relative; display: flex; justify-content: space-around; align-items: center;
}
.eye-glow {
    width: 15px; height: 15px; background: #fff;
    border-radius: 50%; box-shadow: 0 0 25px #fff;
    animation: eye-flicker 0.1s infinite;
}
.intro-text {
    color: #fff; font-size: 4rem; font-weight: 900;
    text-transform: uppercase; margin-top: 20px;
    text-shadow: 4px 4px 0 currentColor;
    font-family: 'Courier New', monospace;
    animation: slam 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}
@keyframes eye-flicker { 0% { opacity: 0.8; } 100% { opacity: 1; transform: scale(1.1); } }
@keyframes slam { 0% { transform: scale(2); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
:root {
    --bg-color: #050505;
    --ui-bg: rgba(10, 10, 10, 0.95);
    --font: 'Courier New', monospace;
    --p1-color: #3b82f6;
    --p2-color: #ef4444;
}
body { margin: 0; overflow: hidden; background: var(--bg-color); font-family: var(--font); color: white; user-select: none; }
canvas { display: block; width: 100%; height: 100%; }

/* --- TRANSITION FX --- */
#transition-layer {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    pointer-events: none; z-index: 200; display: none;
}
.shatter-panel {
    position: absolute; width: 100%; height: 50%; background: #000;
    transition: transform 0.8s cubic-bezier(0.7, 0, 0.3, 1);
}
#shatter-top { top: 0; transform-origin: top left; }
#shatter-bot { bottom: 0; transform-origin: bottom right; }

.ink-splash {
    position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0);
    width: 200vw; height: 200vw;
    background: radial-gradient(circle, #000 20%, transparent 70%);
    opacity: 0;
}
.battle-text {
    position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(3);
    font-size: 8rem; font-weight: 900; color: #fff; text-shadow: 10px 10px 0 #b91c1c;
    opacity: 0;
}

/* Animations Triggered by JS */
.anim-shatter #shatter-top { transform: skewY(-10deg) translateY(-120%); }
.anim-shatter #shatter-bot { transform: skewY(-10deg) translateY(120%); }
.anim-ink .ink-splash { animation: ink-expand 0.6s forwards; }
.anim-text .battle-text { animation: text-slam 0.8s forwards; }

@keyframes ink-expand { 0% { transform: translate(-50%, -50%) scale(0); opacity: 1; } 100% { transform: translate(-50%, -50%) scale(1); opacity: 0; } }
@keyframes text-slam { 0% { transform: translate(-50%, -50%) scale(3); opacity: 0; } 20% { opacity: 1; } 80% { opacity: 1; } 100% { transform: translate(-50%, -50%) scale(1.5); opacity: 0; } }

/* --- UI OVERLAY --- */
#ui-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; display: flex; flex-direction: column; justify-content: space-between; }
.hud-top { display: flex; justify-content: space-between; padding: 25px; width: 90%; margin: 0 auto; }
.fighter-hud { width: 420px; background: var(--ui-bg); padding: 15px; border: 2px solid #333; border-radius: 6px; box-shadow: 0 0 20px rgba(0,0,0,0.5); }
.name-tag { font-size: 1.5rem; font-weight: 900; margin-bottom: 5px; letter-spacing: 2px; text-shadow: 0 0 10px currentColor; }
.bar-wrap { height: 16px; background: #222; margin-bottom: 8px; border: 1px solid #444; position: relative; }
.bar-fill { height: 100%; transition: width 0.1s linear; position: relative; z-index: 2; }
.hp { background: linear-gradient(90deg, #15803d, #22c55e); }
.ce { background: linear-gradient(90deg, #4338ca, #6366f1); }
.domain-gauge { background: linear-gradient(90deg, #000, #a855f7); box-shadow: 0 0 10px #a855f7; }
.fatigue { background: #fff; opacity: 0.8; transition: width 0.1s; } 
.hud-bottom { display: flex; flex-direction: column; align-items: center; padding-bottom: 30px; gap: 15px; }
.skills-row { display: flex; gap: 20px; }
.skill-box { width: 90px; height: 90px; background: #1a1a1a; border: 2px solid #555; position: relative; display: flex; flex-direction: column; align-items: center; justify-content: center; border-radius: 8px; overflow: hidden; }
.skill-key { position: absolute; top: 4px; left: 4px; font-size: 0.7rem; color: #aaa; }
.skill-name { position: absolute; bottom: 0; width: 100%; text-align: center; font-size: 0.6rem; background: rgba(0,0,0,0.8); padding: 3px 0; color: #bbb; }
.cd-overlay { position: absolute; bottom: 0; left: 0; width: 100%; height: 0%; background: rgba(200, 50, 50, 0.7); transition: height 0.1s linear; }

#alert-banner { position: absolute; top: 30%; width: 100%; text-align: center; font-size: 5rem; font-weight: 900; color: #fff; display: none; text-shadow: 0 0 30px currentColor; z-index: 10; animation: pulse 0.1s infinite; }
#bf-counter { position: absolute; top: 45%; width: 100%; text-align: center; font-size: 3rem; font-weight: 900; color: #b91c1c; display: none; text-shadow: 0 0 20px #000; z-index: 10; }
@keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.02); } 100% { transform: scale(1); } }

/* --- MENUS --- */
.menu-screen { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: #080808; z-index: 20; display: flex; flex-direction: column; align-items: center; justify-content: center; pointer-events: all; }
.glitch-title { font-size: 4rem; position: relative; color: white; letter-spacing: 5px; animation: glitch 1s infinite; }
@keyframes glitch {
  0% { text-shadow: 2px 2px #ff0055, -2px -2px #00ccff; }
  25% { text-shadow: -2px 2px #ff0055, 2px -2px #00ccff; }
  50% { text-shadow: 2px -2px #ff0055, -2px 2px #00ccff; }
  75% { text-shadow: -2px -2px #ff0055, 2px 2px #00ccff; }
  100% { text-shadow: 2px 2px #ff0055, -2px -2px #00ccff; }
}

.btn-start { background: transparent; border: 2px solid white; color: white; padding: 15px 50px; font-size: 1.5rem; cursor: pointer; margin-top: 30px; font-family: var(--font); transition: 0.3s; }
.btn-start:hover { background: white; color: black; box-shadow: 0 0 20px white; }

/* --- NEW CHARACTER SELECT --- */
.select-header { font-size: 2rem; border-bottom: 2px solid #333; padding-bottom: 10px; width: 90%; text-align: center; margin-bottom: 20px; letter-spacing: 3px; }
.instruction-text { margin-top: 20px; color: #aaa; animation: blink 1s infinite; }
@keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }

.vs-container { display: flex; width: 90%; height: 40%; justify-content: space-between; align-items: center; margin-bottom: 30px; }
.player-panel { width: 40%; height: 100%; display: flex; flex-direction: column; }
.player-label { font-size: 1.5rem; font-weight: bold; color: var(--p1-color); margin-bottom: 10px; border-bottom: 4px solid currentColor; }

.char-portrait { 
    flex: 1; background: #111; border: 2px solid #333; position: relative; overflow: hidden; 
    box-shadow: inset 0 0 50px #000; transition: border-color 0.3s;
}
.portrait-img { 
    width: 100%; height: 100%; background-size: cover; background-position: center; 
    transition: transform 0.2s; filter: grayscale(0.8);
}
.portrait-name { 
    position: absolute; bottom: 10px; left: 0; width: 100%; text-align: center; 
    font-size: 2.5rem; font-weight: 900; color: #fff; text-shadow: 3px 3px 0 #000;
    text-transform: uppercase;
    background: linear-gradient(to top, rgba(0,0,0,0.9), transparent);
}
.vs-logo { font-size: 6rem; font-weight: 900; color: #fff; text-shadow: 0 0 20px #ff0055; font-style: italic; }

.char-grid { 
    display: flex; gap: 15px; flex-wrap: wrap; justify-content: center; width: 80%; 
}
.grid-slot {
    width: 100px; height: 100px; background: #222; border: 2px solid #444; 
    cursor: pointer; position: relative; overflow: hidden; transition: 0.2s;
    display: flex; align-items: center; justify-content: center;
}
.grid-slot:hover { border-color: #fff; transform: scale(1.1); z-index: 10; }
.grid-slot img { width: 100%; height: 100%; object-fit: cover; opacity: 0.6; }
.grid-slot:hover img { opacity: 1; }
.slot-name { 
    position: absolute; bottom: 0; font-size: 0.7rem; width: 100%; 
    text-align: center; background: rgba(0,0,0,0.8); color: #fff; 
}

/* --- CUT IN INTRO --- */
#intro-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 100; display: none; align-items: center; justify-content: center; flex-direction: column; }
.cut-in-face { width: 300px; height: 120px; background: #ffe0bd; border-top: 4px solid #000; border-bottom: 4px solid #000; position: relative; overflow: hidden; display: flex; justify-content: center; align-items: center; box-shadow: 0 0 50px currentColor; }
.gojo-blindfold { width: 100%; height: 60px; background: #111; position: absolute; top: 30px; left: 0; box-shadow: 0 5px 10px rgba(0,0,0,0.5); }
.cut-in-eyes { width: 100%; height: 40px; background: #000; position: relative; display: flex; justify-content: space-around; align-items: center; }
.eye-glow { width: 15px; height: 15px; background: #fff; border-radius: 50%; box-shadow: 0 0 25px #fff; animation: eye-flicker 0.1s infinite; }
.intro-text { color: #fff; font-size: 4rem; font-weight: 900; text-transform: uppercase; margin-top: 20px; text-shadow: 4px 4px 0 currentColor; font-family: 'Courier New', monospace; animation: slam 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
@keyframes eye-flicker { 0% { opacity: 0.8; } 100% { opacity: 1; transform: scale(1.1); } }
@keyframes slam { 0% { transform: scale(2); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
:root {
    --bg-color: #050505;
    --ui-bg: rgba(5, 5, 5, 0.95);
    --font: 'Impact', 'Arial Black', sans-serif;
    --p1-color: #3b82f6;
    --p2-color: #ef4444;
}

body { margin: 0; overflow: hidden; background: var(--bg-color); font-family: var(--font); color: white; user-select: none; }
canvas { display: block; width: 100%; height: 100%; }

/* --- NOISE OVERLAY (GRITTY TEXTURE) --- */
.noise-overlay {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 900;
    opacity: 0.05; background: url('https://grainy-gradients.vercel.app/noise.svg');
}

/* --- CURTAIN TRANSITION --- */
#curtain-layer {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 500; display: none;
}
.curtain-black {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: #000;
    transform: scaleY(0); transform-origin: top; transition: transform 0.5s cubic-bezier(0.8,0,0.2,1);
}
.curtain-text {
    position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(2);
    font-size: 5rem; color: #fff; opacity: 0; letter-spacing: 10px; text-align: center;
    text-shadow: 0 0 20px #fff; width: 100%;
}
.curtain-line {
    position: absolute; top: 50%; left: 0; width: 100%; height: 2px; background: #fff;
    transform: scaleX(0); transition: transform 0.3s;
}

/* --- ANIMATIONS --- */
.anim-drop .curtain-black { transform: scaleY(1); }
.anim-flash .curtain-line { transform: scaleX(1); box-shadow: 0 0 50px #fff; }
.anim-show-text .curtain-text { animation: text-flicker 1s forwards; }

@keyframes text-flicker {
    0% { opacity: 0; transform: translate(-50%,-50%) scale(2); }
    10% { opacity: 1; }
    20% { opacity: 0; }
    30% { opacity: 1; }
    100% { opacity: 1; transform: translate(-50%,-50%) scale(1); }
}

/* --- UI ELEMENTS --- */
#ui-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; display: flex; flex-direction: column; justify-content: space-between; }
.hud-top { display: flex; justify-content: space-between; padding: 25px; width: 90%; margin: 0 auto; }
.fighter-hud { width: 420px; background: var(--ui-bg); padding: 15px; border: 2px solid #333; border-radius: 2px; box-shadow: 0 0 20px rgba(0,0,0,0.5); }
.name-tag { font-size: 2rem; margin-bottom: 5px; letter-spacing: 2px; text-transform: uppercase; }

.bar-wrap { height: 18px; background: #222; margin-bottom: 8px; border: 1px solid #555; position: relative; }
.bar-fill { height: 100%; transition: width 0.1s linear; }
.hp { background: #22c55e; box-shadow: 0 0 10px #22c55e; }
.ce { background: #3b82f6; box-shadow: 0 0 10px #3b82f6; }
.domain-gauge { background: #a855f7; box-shadow: 0 0 10px #a855f7; }

/* --- MENUS --- */
.menu-screen { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 50; display: flex; flex-direction: column; align-items: center; justify-content: center; pointer-events: all; }
.jjk-title { 
    font-size: 6rem; line-height: 0.9; text-align: center; letter-spacing: -5px; 
    color: transparent; -webkit-text-stroke: 2px #fff; 
    text-shadow: 5px 5px 0 #fff; margin: 0;
}
.menu-line { width: 200px; height: 5px; background: #ff0055; margin: 20px 0; }
.btn-start { 
    background: #000; border: 2px solid #fff; color: #fff; padding: 20px 60px; 
    font-size: 1.5rem; font-family: var(--font); cursor: pointer; transition: 0.2s;
    letter-spacing: 2px;
}
.btn-start:hover { background: #fff; color: #000; box-shadow: 0 0 30px #fff; }

/* --- CHARACTER SELECT (FIGHTING GAME STYLE) --- */
.cs-header { font-size: 2rem; color: #888; letter-spacing: 5px; margin-bottom: 10px; border-bottom: 1px solid #444; width: 90%; text-align: center; }
.vs-stage { display: flex; width: 90%; height: 55%; justify-content: space-between; align-items: center; }

.p-card { 
    width: 35%; height: 100%; border: 1px solid #333; background: #0a0a0a; 
    display: flex; flex-direction: column; position: relative; overflow: hidden;
    transition: 0.3s;
}
.p-model { 
    flex: 1; background-size: cover; background-position: center; transition: 0.3s;
    filter: grayscale(1) brightness(0.5);
}
.p-info { 
    height: 120px; background: rgba(0,0,0,0.9); padding: 10px; border-top: 1px solid #333;
    display: flex; flex-direction: column; justify-content: center;
}
.p-info h2 { margin: 0; font-size: 2.5rem; color: #fff; letter-spacing: 2px; }
.lore-text { font-family: 'Courier New', monospace; font-size: 0.7rem; color: #aaa; margin: 5px 0 0 0; line-height: 1.2; }

.vs-center { width: 10%; display: flex; justify-content: center; align-items: center; }
.vs-text { font-size: 5rem; color: #333; font-style: italic; text-shadow: 0 0 20px #ff0055; color: #fff; }

.roster-area { width: 90%; flex: 1; display: flex; justify-content: center; align-items: center; margin-top: 10px; }
.roster-grid { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; max-width: 900px; }

.char-slot { 
    width: 70px; height: 70px; background: #222; border: 2px solid #444; cursor: pointer;
    display: flex; align-items: center; justify-content: center; transition: 0.2s;
    position: relative; overflow: hidden;
}
.char-slot:hover { transform: scale(1.1); border-color: #fff; z-index: 10; box-shadow: 0 0 15px #fff; }
.slot-initial { font-size: 1.5rem; font-weight: bold; color: rgba(255,255,255,0.2); }
.slot-name-hover { position: absolute; bottom: 0; width: 100%; font-size: 0.6rem; background: rgba(0,0,0,0.8); color: #fff; text-align: center; }

/* Active States for P1/P2 selection */
.p1-active { border-color: #3b82f6; box-shadow: 0 0 20px rgba(59, 130, 246, 0.3); }
.p2-active { border-color: #ef4444; box-shadow: 0 0 20px rgba(239, 68, 68, 0.3); }

/* --- INTRO & SKILLS --- */
#intro-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 100; display: none; align-items: center; justify-content: center; flex-direction: column; }
.cut-in-face { width: 300px; height: 120px; background: #ffe0bd; border-top: 4px solid #000; border-bottom: 4px solid #000; position: relative; overflow: hidden; display: flex; justify-content: center; align-items: center; box-shadow: 0 0 50px currentColor; }
.gojo-blindfold { width: 100%; height: 60px; background: #111; position: absolute; top: 30px; left: 0; box-shadow: 0 5px 10px rgba(0,0,0,0.5); }
.cut-in-eyes { width: 100%; height: 40px; background: #000; position: relative; display: flex; justify-content: space-around; align-items: center; }
.eye-glow { width: 15px; height: 15px; background: #fff; border-radius: 50%; box-shadow: 0 0 25px #fff; animation: eye-flicker 0.1s infinite; }
.intro-text { color: #fff; font-size: 4rem; font-weight: 900; text-transform: uppercase; margin-top: 20px; text-shadow: 4px 4px 0 currentColor; font-family: 'Courier New', monospace; animation: slam 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
@keyframes eye-flicker { 0% { opacity: 0.8; } 100% { opacity: 1; transform: scale(1.1); } }
@keyframes slam { 0% { transform: scale(2); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }

.hud-bottom { display: flex; flex-direction: column; align-items: center; padding-bottom: 30px; gap: 15px; }
.skills-row { display: flex; gap: 20px; }
.skill-box { width: 90px; height: 90px; background: #1a1a1a; border: 2px solid #555; position: relative; display: flex; flex-direction: column; align-items: center; justify-content: center; border-radius: 2px; }
.skill-key { position: absolute; top: 4px; left: 4px; font-size: 0.7rem; color: #aaa; }
.skill-name { position: absolute; bottom: 0; width: 100%; text-align: center; font-size: 0.6rem; background: rgba(0,0,0,0.8); padding: 3px 0; color: #bbb; }
.cd-overlay { position: absolute; bottom: 0; left: 0; width: 100%; height: 0%; background: rgba(200, 50, 50, 0.7); transition: height 0.1s linear; }
#alert-banner { position: absolute; top: 30%; width: 100%; text-align: center; font-size: 5rem; font-weight: 900; color: #fff; display: none; text-shadow: 0 0 30px currentColor; z-index: 10; animation: pulse 0.1s infinite; }
#bf-counter { position: absolute; top: 45%; width: 100%; text-align: center; font-size: 3rem; font-weight: 900; color: #b91c1c; display: none; text-shadow: 0 0 20px #000; z-index: 10; }
:root {
    --bg-color: #050505;
    --ui-bg: rgba(5, 5, 5, 0.95);
    --font: 'Impact', 'Arial Black', sans-serif;
}

body { margin: 0; overflow: hidden; background: var(--bg-color); font-family: var(--font); color: white; user-select: none; }
canvas { display: block; width: 100%; height: 100%; }

/* --- NOISE OVERLAY --- */
.noise-overlay {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 900;
    opacity: 0.05; background: url('https://grainy-gradients.vercel.app/noise.svg');
}

/* --- NEW TITLE STYLE (Smoother, Cursed Glow) --- */
.jjk-title { 
    font-size: 5.5rem; line-height: 1; text-align: center; letter-spacing: 2px;
    color: #fff; margin: 0;
    text-shadow: 
        0 0 10px #fff,
        0 0 20px #ff0055,
        0 0 40px #ff0055,
        0 0 80px #b91c1c;
    animation: title-pulse 3s infinite;
    transform: skewX(-5deg);
}
@keyframes title-pulse {
    0%, 100% { filter: brightness(1) blur(0.5px); text-shadow: 0 0 20px #ff0055; }
    50% { filter: brightness(1.2) blur(0px); text-shadow: 0 0 40px #ff0055, 0 0 80px #ff0055; }
}

.menu-line { width: 300px; height: 4px; background: #fff; margin: 25px 0; box-shadow: 0 0 15px #fff; }

.btn-start { 
    background: transparent; border: 1px solid rgba(255,255,255,0.3); color: #ddd; 
    padding: 15px 50px; font-size: 1.2rem; font-family: 'Courier New', monospace; 
    cursor: pointer; transition: 0.3s; letter-spacing: 3px;
    text-transform: uppercase;
}
.btn-start:hover { background: #fff; color: #000; box-shadow: 0 0 40px rgba(255,255,255,0.5); border-color: #fff; }

/* --- UI LAYOUTS --- */
#ui-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; display: flex; flex-direction: column; justify-content: space-between; }
.hud-top { display: flex; justify-content: space-between; padding: 25px; width: 90%; margin: 0 auto; }
.fighter-hud { width: 420px; background: var(--ui-bg); padding: 15px; border: 2px solid #333; box-shadow: 0 0 20px rgba(0,0,0,0.5); }
.name-tag { font-size: 2rem; margin-bottom: 5px; letter-spacing: 2px; text-transform: uppercase; }

.bar-wrap { height: 18px; background: #222; margin-bottom: 8px; border: 1px solid #555; position: relative; }
.bar-fill { height: 100%; transition: width 0.1s linear; }
.hp { background: #22c55e; } .ce { background: #3b82f6; } .domain-gauge { background: #a855f7; }

/* --- MENUS & SELECT --- */
.menu-screen { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: #080808; z-index: 50; display: flex; flex-direction: column; align-items: center; justify-content: center; pointer-events: all; }
.cs-header { font-size: 2rem; color: #888; letter-spacing: 5px; margin-bottom: 10px; border-bottom: 1px solid #444; width: 90%; text-align: center; }
.vs-stage { display: flex; width: 90%; height: 55%; justify-content: space-between; align-items: center; }
.p-card { width: 35%; height: 100%; border: 1px solid #333; background: #0a0a0a; display: flex; flex-direction: column; transition: 0.3s; }
.p-model { flex: 1; background-size: cover; background-position: center; transition: 0.3s; filter: grayscale(1) brightness(0.5); }
.p-info { height: 120px; background: rgba(0,0,0,0.9); padding: 10px; border-top: 1px solid #333; display: flex; flex-direction: column; justify-content: center; }
.vs-center { width: 10%; display: flex; justify-content: center; align-items: center; }
.vs-text { font-size: 5rem; color: #fff; font-style: italic; text-shadow: 0 0 20px #ff0055; }
.roster-area { width: 90%; flex: 1; display: flex; justify-content: center; align-items: center; margin-top: 10px; }
.roster-grid { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; max-width: 900px; }
.char-slot { width: 70px; height: 70px; background: #222; border: 2px solid #444; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: 0.2s; position: relative; overflow: hidden; }
.char-slot:hover { transform: scale(1.1); border-color: #fff; z-index: 10; box-shadow: 0 0 15px #fff; }
.p1-active { border-color: #3b82f6; box-shadow: 0 0 20px rgba(59, 130, 246, 0.3); }
.p2-active { border-color: #ef4444; box-shadow: 0 0 20px rgba(239, 68, 68, 0.3); }

/* --- CURTAIN TRANSITION --- */
#curtain-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 500; display: none; }
.curtain-black { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: #000; transform: scaleY(0); transform-origin: top; transition: transform 0.5s cubic-bezier(0.8,0,0.2,1); }
.curtain-text { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(2); font-size: 5rem; color: #fff; opacity: 0; letter-spacing: 10px; text-align: center; width: 100%; }
.curtain-line { position: absolute; top: 50%; left: 0; width: 100%; height: 2px; background: #fff; transform: scaleX(0); transition: transform 0.3s; }
.anim-drop .curtain-black { transform: scaleY(1); }
.anim-flash .curtain-line { transform: scaleX(1); box-shadow: 0 0 50px #fff; }
.anim-show-text .curtain-text { animation: text-flicker 1s forwards; }
@keyframes text-flicker { 0% { opacity: 0; transform: translate(-50%,-50%) scale(2); } 10% { opacity: 1; } 20% { opacity: 0; } 30% { opacity: 1; } 100% { opacity: 1; transform: translate(-50%,-50%) scale(1); } }

/* --- UNIQUE CHARACTER INTRO VISUALS --- */
#intro-layer { 
    position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 100; 
    display: none; align-items: center; justify-content: center; flex-direction: column; 
}
.intro-text { 
    color: #fff; font-size: 4rem; font-weight: 900; text-transform: uppercase; margin-top: 30px; 
    text-shadow: 4px 4px 0 currentColor; font-family: 'Courier New', monospace; 
    animation: slam 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
}
@keyframes slam { 0% { transform: scale(2); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }

/* Base Head Shape */
.vis-head {
    width: 200px; height: 100px; /* Rectangular Cut-in style */
    background: #ffe0bd; /* Skin tone */
    position: relative; overflow: hidden;
    border-top: 5px solid #000; border-bottom: 5px solid #000;
    box-shadow: 0 0 40px rgba(255, 255, 255, 0.2);
    display: flex; justify-content: center; align-items: center;
}

/* Common Eye Structure */
.vis-eyes {
    width: 100%; display: flex; justify-content: space-around; align-items: center; position: absolute; top: 40%;
}
.vis-eye {
    width: 12px; height: 12px; border-radius: 50%; background: #000;
    box-shadow: 0 0 10px #fff;
    animation: blink 3s infinite;
}
@keyframes blink { 0%, 90%, 100% { transform: scaleY(1); } 95% { transform: scaleY(0.1); } }

/* -- 1. YUJI -- */
.vis-yuji { background: #ffe0bd; }
.vis-yuji::before { /* Hair */
    content: ''; position: absolute; top: -10px; width: 120%; height: 30px; 
    background: #ff99cc; clip-path: polygon(0% 0%, 100% 0%, 90% 100%, 80% 60%, 70% 100%, 60% 60%, 50% 100%, 40% 60%, 30% 100%, 20% 60%, 10% 100%, 0% 0%);
}
.vis-yuji .vis-eye { background: #5c3a21; box-shadow: none; }
.vis-yuji::after { /* Scars */
    content: ''; position: absolute; top: 55%; width: 100%; height: 10px;
    background: transparent;
    box-shadow: 40px 0 0 -3px #a11, 150px 0 0 -3px #a11;
}

/* -- 2. GOJO -- */
.vis-gojo { background: #ffe0bd; }
.vis-gojo::before { /* Hair */
    content: ''; position: absolute; top: -15px; width: 120%; height: 40px; background: #fff;
    clip-path: polygon(0 0, 100% 0, 95% 100%, 85% 70%, 75% 100%, 65% 70%, 55% 100%, 45% 70%, 35% 100%, 25% 70%, 15% 100%, 5% 70%);
}
.vis-gojo .vis-eyes { display: none; } /* Hidden eyes */
.vis-gojo::after { /* Blindfold */
    content: ''; position: absolute; top: 30px; width: 100%; height: 45px; background: #000;
}

/* -- 3. SUKUNA -- */
.vis-sukuna { background: #ffe0bd; }
.vis-sukuna::before { /* Hair */
    content: ''; position: absolute; top: -10px; width: 120%; height: 30px; background: #ffaaaa;
    clip-path: polygon(0 0, 100% 0, 90% 100%, 10% 100%);
}
.vis-sukuna .vis-eye { background: #ff0000; box-shadow: 0 0 15px #ff0000; }
.vis-sukuna::after { /* Tattoos & Extra Eyes */
    content: ''; position: absolute; top: 15px; width: 100%; height: 100%;
    background: radial-gradient(circle at 75% 25%, #ff0000 2px, transparent 3px); /* Eye mask area */
    border-top: 2px solid #000; /* Nose line */
}
.vis-sukuna .vis-eyes::before { /* Extra eyes small */
    content:''; position: absolute; top: -15px; right: 20px; width: 8px; height: 8px; background: #f00; border-radius: 50%; box-shadow: 0 0 10px #f00;
}

/* -- 4. MEGUMI -- */
.vis-megumi { background: #ffe0bd; }
.vis-megumi::before { /* Spiky Hair */
    content: ''; position: absolute; top: -20px; width: 130%; height: 60px; background: #000;
    clip-path: polygon(0 40%, 10% 0, 20% 50%, 30% 0, 40% 60%, 50% 0, 60% 60%, 70% 0, 80% 50%, 90% 0, 100% 40%, 100% 100%, 0 100%);
}
.vis-megumi .vis-eye { background: #22c55e; box-shadow: 0 0 5px #22c55e; width: 10px; height: 6px; }

/* -- 5. YUTA -- */
.vis-yuta { background: #ffe0bd; }
.vis-yuta::before { /* Messy Hair */
    content: ''; position: absolute; top: -10px; width: 110%; height: 50px; background: #111;
    border-radius: 50% 50% 0 0;
}
.vis-yuta .vis-eye { background: #001133; width: 14px; height: 14px; border-radius: 50%; border: 1px solid #000; }
.vis-yuta::after { /* Dark Circles */
    content: ''; position: absolute; top: 55%; width: 100%; height: 5px;
    background: transparent; box-shadow: 40px 0 5px rgba(0,0,0,0.5), 150px 0 5px rgba(0,0,0,0.5);
}

/* -- 6. HAKARI -- */
.vis-hakari { background: #dcbfa8; }
.vis-hakari::before { /* Purple Dreads */
    content: ''; position: absolute; top: -15px; width: 110%; height: 50px; background: #8800ff;
    border-radius: 20px 20px 0 0;
    background-image: repeating-linear-gradient(90deg, #6600cc, #6600cc 10px, #8800ff 10px, #8800ff 20px);
}
.vis-hakari .vis-eye { background: #fff; width: 10px; height: 4px; } /* Slits */
.vis-hakari::after { /* Stubble */
    content: ''; position: absolute; bottom: 0; width: 100%; height: 20px; background: rgba(0,0,0,0.1);
}

/* -- 7. KASHIMO -- */
.vis-kashimo { background: #ffe0bd; }
.vis-kashimo::before { /* Cyan Hair buns */
    content: ''; position: absolute; top: -10px; width: 120%; height: 50px; background: #00ffff;
    clip-path: circle(30% at 20% 40%); box-shadow: 100px 0 0 #00ffff;
}
.vis-kashimo .vis-eye { background: #00ffff; box-shadow: 0 0 10px #00ffff; }
.vis-kashimo::after { /* Lightning Marks */
    content: ''; position: absolute; top: 50%; left: 10%; width: 10px; height: 20px;
    background: #000; clip-path: polygon(100% 0, 0 100%, 100% 100%);
}

/* -- 8. TOJI -- */
.vis-toji { background: #ffe0bd; }
.vis-toji::before { /* Black Hair */
    content: ''; position: absolute; top: -10px; width: 110%; height: 40px; background: #111;
}
.vis-toji .vis-eye { background: #22c55e; border: 1px solid #000; }
.vis-toji::after { /* Lip Scar */
    content: ''; position: absolute; bottom: 20px; right: 60px; width: 15px; height: 2px; background: #550000; transform: rotate(-20deg);
}

/* -- 9. MAHITO -- */
.vis-mahito { background: #d0d0d0; } /* Grey skin */
.vis-mahito::before { /* Grey Hair */
    content: ''; position: absolute; top: -10px; width: 110%; height: 50px; background: #aaa;
    border-bottom: 2px solid #555;
}
.vis-mahito .vis-eye:first-child { background: #aaa; } /* Heterochromia */
.vis-mahito .vis-eye:last-child { background: #000088; }
.vis-mahito::after { /* Stitches */
    content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    background: repeating-linear-gradient(45deg, transparent, transparent 10px, rgba(0,0,0,0.2) 11px);
}

/* -- 10. MAHORAGA -- */
.vis-mahoraga { background: #ddd; }
.vis-mahoraga::before { /* Wheel */
    content: ''; position: absolute; top: -40px; left: 50%; transform: translateX(-50%);
    width: 60px; height: 60px; border: 4px solid #d4af37; border-radius: 50%;
}
.vis-mahoraga .vis-eye { background: #fff; width: 100%; height: 20px; border-radius: 0; box-shadow: 0 0 15px #fff; }
.vis-mahoraga .vis-eyes { top: 30%; }
.vis-mahoraga::after { /* Wings hint */
    content: ''; position: absolute; top: 10px; right: -10px; width: 20px; height: 40px; background: #fff; transform: rotate(20deg);
}